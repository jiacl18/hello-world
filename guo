均匀裂变源方法

1、应用背景
===========

蒙特卡罗程序在模拟中子输运的过程中，采用统计的方法来得到诸如中子注量率、功率密度、有效增殖因子等参数，因此所有的计算结果都会带有统计偏差。为了衡量蒙卡程序计算精确度，普遍接受的标准是所谓的“95/95准则”，即要求在95%的置信水平下，计算区域中超过95%的区域的相对误差不超过1%。

在大型反应堆堆芯计算中，中心区域中子注量率高，功率密度大，因而计算结果带有的统计方差较小；而在堆芯外部区域，中子注量率低，功率密度小，计算结果的统计方差较大。为了达到降低误差的目的，可采取以下的方法：

1. 统计量的方差与抽样样品数为负相关，因此可以简单通过增加模拟粒子数的方法来减少误差；

2. 采用全局减方差技巧，即在低功率区域降低权重上限，以分裂更多的粒子，从而达到减小低功率区域的统计偏差；

3. 采用均匀裂变源方法，增加低功率区域粒子数，降低高功率区域粒子数，使抽样粒子分布均匀，以此达到减小误差的目的。

方法1原理简单，但通过单纯增加粒子数的方法会明显增加计算成本，同时产生的抽样粒子依然会主要存在于高功率区域，很难达到有效减少低功率区域误差的目的。方法2通过增加低功率区域的分裂粒子数，虽然也能降低误差，但对分裂粒子的计算也会明显增加计算时间。因此，对于这样的问题，往往会选择采用UFS方法。

2、UFS方法基本原理
==================

在蒙卡计算的标准过程中，一个权重为\ :math:`\omega_{\text{in}}`\ 的入射中子因碰撞而产生的裂变中子数\ :math:`m_{\text{std}}`\ 为：

+----------------------------------------------------------------------------------+-------+
| .. math:: m_{\text{std}} = \omega_{\text{in}}\frac{\upsilon\sum_{f}}{\sum_{t}}   | (1)   |
+----------------------------------------------------------------------------------+-------+

式中：

+--------------------------------+----+--------------------+
| .. math:: m_{\text{std}}       |    | 产生的裂变中子数   |
+================================+====+====================+
| .. math:: \omega_{\text{in}}   |    | 初始入射中子权重   |
+--------------------------------+----+--------------------+
| .. math:: \upsilon             |    | 平均裂变中子数     |
+--------------------------------+----+--------------------+
| .. math:: \sum_{f}             |    | 宏观裂变截面       |
+--------------------------------+----+--------------------+
| .. math:: \sum_{t}             |    | 宏观总截面         |
+--------------------------------+----+--------------------+

产生的裂变中子储存在裂变库中，并在下一次的抽样计算中，通过均匀抽样的方式在裂变库中抽取中子，设置初始权重为1，开始计算。

对于UFS方法，会首先将所有包含裂变材料的区域划分为若干个网格，计算每个网格占全部裂变区域的体积比\ :math:`V_{k}`\ 以及位于该网格内的裂变中子源占全部区域中子源之比\ :math:`S_{k}`\ 。这时，每次碰撞产生的裂变中子数\ :math:`m_{\text{ufs}}`\ 变为:

+-----------------------------------------------------------------------------------------------------+-------+
| .. math:: m_{\text{ufs}} = \omega_{\text{in}}\frac{\upsilon\sum_{f}}{\sum_{t}}\frac{V_{k}}{S_{k}}   | (2)   |
+-----------------------------------------------------------------------------------------------------+-------+

所有产生的裂变中子存储在裂变库中，作为下一代均匀抽样的裂变中子源。同时，为了保证计算的无偏性，抽样得到的中子权重有1调整为\ :math:`\frac{S_{k}}{V_{k}}`\ 。

3、UFS方法在RMC中实现
=====================

结合RMC程序自身特点，对原方法进行了如下改进：

RMC临界计算中采用源迭代方法，每代计算中都需保持中子的总权重不变。在第一代计算时，设定中子数为\ :math:`N_{h\text{ist}}`\ ，总权重为\ :math:`N_{h\text{ist}}`\ 。在每代计算结束时，存储在裂变库中的中子数\ :math:`N_{\text{bank}}`\ 作为下一代的裂变源进行抽样，每个中子的权重变为：

+--------------------------------------------------------------------------+-------+
| .. math:: \omega_{\text{in}} = \frac{N_{h\text{ist}}}{N_{\text{bank}}}   | (3)   |
+--------------------------------------------------------------------------+-------+

采用UFS方法后，从裂变库中每抽样1个裂变中子，会定位该粒子所在的UFS网格位置，得到相应区域的\ :math:`\frac{V_{k}}{S_{k}}`\ ，则抽样粒子的权重变为：

+----------------------------------------------------------------------------------------------------------+-------+
| .. math:: \omega_{\text{in}}^{'} = \frac{N_{h\text{ist}}}{N_{\text{bank}}} \bullet \frac{S_{k}}{V_{k}}   | (4)   |
+----------------------------------------------------------------------------------------------------------+-------+

为保证统计的无偏性，当\ :math:`\frac{V_{k}}{S_{k} < 1}`\ 时，对粒子进行轮盘赌：粒子存活概率为：\ :math:`P_{\text{sur}} = \frac{V_{k}}{S_{k}}`\ ，粒子被杀死的概率为\ :math:`P_{\text{kill}} = 1 - \frac{V_{k}}{S_{k}}`\ ，因此粒子的实际权重为：

+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| .. math:: \omega_{\text{neut}} = 0 \times P_{\text{kill}} + \frac{N_{h\text{ist}}}{N_{\text{bank}}} \bullet \frac{S_{k}}{V_{k}} \times P_{\text{sur}} = \frac{N_{h\text{ist}}}{N_{\text{bank}}}   | (5)   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+

当\ :math:`\frac{V_{k}}{S_{k} > 1}`\ 时，则分裂该粒子，并以\ :math:`\frac{V_{k}}{S_{k}} - \left\lfloor \frac{V_{k}}{S_{k}} \right\rfloor`\ 的概率（\ :math:`\left\lfloor \right\rfloor`\ 为向下取整符号）的得到\ :math:`\left\lfloor \frac{V_{k}}{S_{k}} \right\rfloor + 1`\ 个抽样粒子，以\ :math:`1 - (\frac{V_{k}}{S_{k}} - \left\lfloor \frac{V_{k}}{S_{k}} \right\rfloor)`\ 的概率得到\ :math:`\left\lfloor \frac{V_{k}}{S_{k}} \right\rfloor`\ 个抽样粒子，此时该粒子的实际权重为：

+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| .. math:: \omega_{\text{neut}} = \left\{ \left\lbrack 1 - (\frac{V_{k}}{S_{k}} - \left\lfloor \frac{V_{k}}{S_{k}} \right\rfloor) \right\rbrack \times \left\lfloor \frac{V_{k}}{S_{k}} \right\rfloor + (\frac{V_{k}}{S_{k}} - \left\lfloor \frac{V_{k}}{S_{k}} \right\rfloor) \times \left( \left\lfloor \frac{V_{k}}{S_{k}} \right\rfloor + 1 \right) \right\} \times \frac{N_{h\text{ist}}}{N_{\text{bank}}} \bullet \frac{S_{k}}{V_{k}} = \frac{N_{h\text{ist}}}{N_{\text{bank}}}   | (6)   |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+

式(5)、(6)表明，采用这样的处理方式并未改变每代裂变中子的总权重，但有效地改变了源中子的分布，使其分布趋于均匀，一方面减少了高中子注量率网格的源中子，又增加了低中子注量率网格的源中子，总体并不会增加额外计算时间。

4、UFS方法应用技巧
==================

4.1 :math:`\frac{\mathbf{S}_{\mathbf{k}}}{\mathbf{V}_{\mathbf{k}}}`\ 统计波动性的减小
-------------------------------------------------------------------------------------

在UFS的原方法中，当前的\ :math:`S_{k}`\ 由已计算的所有代累加值计算得到。而在临界计算的非活跃代中，临界源并未收敛，所以为了减少初始代裂变源的\ :math:`S_{k}`\ 的影响，在RMC中，从非活跃代后半部分才开始统计裂变源。统计得到的\ :math:`S_{k}`\ 在非活跃代并不适用，直到活跃代第1代才开始使用UFS方法，并继续统计\ :math:`S_{k}`\ 。

4.2中子截断权重的设置
---------------------

在蒙卡计算中，会分别设置允许的最大权重与最小权重，这两个权重值一般设置为0.25与4.0。当一个中子权重小于最小权重时，对进行轮盘赌，而中子权重大于最大权重时，便会进行分裂。而在UFS方法中，会在中子注量率很低的地方产生很多权重很小的中子，如果最小权重仍然为0.25，这样UFS方法带来的优势会被抵消而失效。

在原UFS方法，会将这两个权重值修改为0.01与5.0，而在RMC中设置为一种可自动调整权重的方法，即每个UFS网格中的最小权重变为\ :math:`\omega_{c}\frac{S_{k}}{V_{k}}`\ ，其中\ :math:`\omega_{c} = 0.01`\ 。这样的方法可以根据抽样源中子权重的调整自动调整最小截断权重。
